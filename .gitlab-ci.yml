stages:
  - build
  - test
  - package

variables:
  # Java 21
  JAVA_HOME: "/usr/lib/jvm/java-21-openjdk"
  MAVEN_CLI_OPTS: "-B -V"

before_script:
  - export PATH="$JAVA_HOME/bin:$PATH"

# 1️⃣ Build Maven (compile)
build:
  stage: build
  image: maven:3.9.3-eclipse-temurin-21
  script:
    - mvn $MAVEN_CLI_OPTS clean compile
  only:
    - branches

# 2️⃣ Run Tests
test:
  stage: test
  image: maven:3.9.3-eclipse-temurin-21
  script:
    - mvn $MAVEN_CLI_OPTS test
  only:
    - branches

# 3️⃣ Package JAR
package:
  stage: package
  image: maven:3.9.3-eclipse-temurin-21
  script:
    - mvn $MAVEN_CLI_OPTS clean package
  artifacts:
    paths:
      - target/*.jar
  only:
    - branches
